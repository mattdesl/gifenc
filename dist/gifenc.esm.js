var J={signature:"GIF",version:"89a",trailer:59,extensionIntroducer:33,applicationExtensionLabel:255,graphicControlExtensionLabel:249,imageSeparator:44,signatureSize:3,versionSize:3,globalColorTableFlagMask:128,colorResolutionMask:112,sortFlagMask:8,globalColorTableSizeMask:7,applicationIdentifierSize:8,applicationAuthCodeSize:3,disposalMethodMask:28,userInputFlagMask:2,transparentColorFlagMask:1,localColorTableFlagMask:128,interlaceFlagMask:64,idSortFlagMask:32,localColorTableSizeMask:7};function T(t=256){let e=0,i=new Uint8Array(t);return{get buffer(){return i.buffer},reset(){e=0},bytesView(){return i.subarray(0,e)},bytes(){return i.slice(0,e)},writeByte(n){r(e+1),i[e]=n,e++},writeBytes(n,o=0,f=n.length){r(e+f);for(let c=0;c<f;c++)i[e++]=n[c+o]},writeBytesView(n,o=0,f=n.byteLength){r(e+f),i.set(n.subarray(o,o+f),e),e+=f}};function r(n){var o=i.length;if(o>=n)return;var f=1024*1024;n=Math.max(n,o*(o<f?2:1.125)>>>0),o!=0&&(n=Math.max(n,256));let c=i;i=new Uint8Array(n),e>0&&i.set(c.subarray(0,e),0)}}var Q=12,$=5003,at=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];function ut(t,e,i,r,n=T(512),o=new Uint8Array(256),f=new Int32Array($),c=new Int32Array($)){let x=f.length,a=Math.max(2,r);o.fill(0),c.fill(0),f.fill(-1);let l=0,s=0,w=a+1,b=w,g=!1,h=b,B=(1<<h)-1,u=1<<w-1,m=u+1,_=u+2,d=0,A=i[0],F=0;for(let y=x;y<65536;y*=2)++F;F=8-F,n.writeByte(a),I(u);let p=i.length;for(let y=1;y<p;y++){t:{let v=i[y],C=(v<<Q)+A,M=v<<F^A;if(f[M]===C){A=c[M];break t}let L=M===0?1:x-M;for(;f[M]>=0;)if(M-=L,M<0&&(M+=x),f[M]===C){A=c[M];break t}I(A),A=v,_<1<<Q?(c[M]=_++,f[M]=C):(f.fill(-1),_=u+2,g=!0,I(u))}}return I(A),I(m),n.writeByte(0),n.bytesView();function I(y){for(l&=at[s],s>0?l|=y<<s:l=y,s+=h;s>=8;)o[d++]=l&255,d>=254&&(n.writeByte(d),n.writeBytesView(o,0,d),d=0),l>>=8,s-=8;if((_>B||g)&&(g?(h=b,B=(1<<h)-1,g=!1):(++h,B=h===Q?1<<h:(1<<h)-1)),y==m){for(;s>0;)o[d++]=l&255,d>=254&&(n.writeByte(d),n.writeBytesView(o,0,d),d=0),l>>=8,s-=8;d>0&&(n.writeByte(d),n.writeBytesView(o,0,d),d=0)}}}var tt=ut;var xt=["rgb444","rgba4444","rgb565"];function D(t){if(!xt.includes(t))throw new Error("Unknown format: "+t)}function G(t,e,i){let r=t>>3,n=e>>2,o=i>>3;return r<<11|n<<5|o}function j(t,e,i,r){return t=t>>4,e=e>>4,i=i>>4,r=r>>4,r<<12|t<<8|e<<4|i}function R(t,e,i){return t=t>>4,e=e>>4,i=i>>4,t<<8|e<<4|i}function V(t,e,i){return t<e?e:t>i?i:t}function q(t){return t*t}function et(t,e,i){var r=0,n=1e100;let o=t[e],f=o.cnt,c=o.ac,x=o.rc,a=o.gc,l=o.bc;for(var s=0,w=o.fw;w!=0;w=t[w].fw){let g=t[w],h=g.cnt,B=f*h/(f+h);if(!(B>=n)){var b=0;i&&(b+=B*q(g.ac-c),b>=n)||(b+=B*q(g.rc-x),!(b>=n)&&(b+=B*q(g.gc-a),!(b>=n)&&(b+=B*q(g.bc-l),!(b>=n)&&(n=b,r=w,s++))))}}s>50&&console.log(s,n,r),o.err=n,o.nn=r}function H(){return{ac:0,rc:0,gc:0,bc:0,cnt:0,nn:0,fw:0,bk:0,tm:0,mtm:0,err:0}}function gt(t,e,i){let r=i==="rgb444"?4096:65536,n=new Array(r);if(i==="rgba4444")for(let o=0;o<e;++o){let f=t.getUint32(o*4,!0),c=f>>24&255,x=f>>16&255,a=f>>8&255,l=f&255,s=j(l,a,x,c),w=s in n?n[s]:n[s]=H();w.rc+=l,w.gc+=a,w.bc+=x,w.ac+=c,w.cnt++}else if(i==="rgb444")for(let o=0;o<e;++o){let f=t.getUint32(o*4,!0),c=f>>16&255,x=f>>8&255,a=f&255,l=R(a,x,c),s=l in n?n[l]:n[l]=H();s.rc+=a,s.gc+=x,s.bc+=c,s.cnt++}else for(let o=0;o<e;++o){let f=t.getUint32(o*4,!0),c=f>>16&255,x=f>>8&255,a=f&255,l=G(a,x,c),s=l in n?n[l]:n[l]=H();s.rc+=a,s.gc+=x,s.bc+=c,s.cnt++}return n}function N(t,e,i={}){let{format:r="rgb444",clearAlpha:n=!0,clearAlphaColor:o=0,clearAlphaThreshold:f=0,oneBitAlpha:c=!1}=i;if(!t||!t.buffer)throw new Error("quantize() expected RGBA Uint8Array data");if(!(t instanceof Uint8Array)&&!(t instanceof Uint8ClampedArray))throw new Error("quantize() expected RGBA Uint8Array data");D(r);let x=new DataView(t.buffer),a=i.useSqrt!==!1,l=r==="rgba4444",s=gt(x,t.length/4,r),w=s.length,b=w-1,g=new Uint32Array(w+1);for(var h=0,u=0;u<w;++u){let k=s[u];if(k!=null){var B=1/k.cnt;l&&(k.ac*=B),k.rc*=B,k.gc*=B,k.bc*=B,s[h++]=k}}q(e)/h<.022&&(a=!1);for(var u=0;u<h-1;++u)s[u].fw=u+1,s[u+1].bk=u,a&&(s[u].cnt=Math.sqrt(s[u].cnt));a&&(s[u].cnt=Math.sqrt(s[u].cnt));var m,_,d;for(u=0;u<h;++u){et(s,u,!1);var A=s[u].err;for(_=++g[0];_>1&&(d=_>>1,!(s[m=g[d]].err<=A));_=d)g[_]=m;g[_]=u}var F=h-e;for(u=0;u<F;){for(var p;;){var I=g[1];if(p=s[I],p.tm>=p.mtm&&s[p.nn].mtm<=p.tm)break;p.mtm==b?I=g[1]=g[g[0]--]:(et(s,I,!1),p.tm=u);var A=s[I].err;for(_=1;(d=_+_)<=g[0]&&(d<g[0]&&s[g[d]].err>s[g[d+1]].err&&d++,!(A<=s[m=g[d]].err));_=d)g[_]=m;g[_]=I}var y=s[p.nn],v=p.cnt,C=y.cnt,B=1/(v+C);l&&(p.ac=B*(v*p.ac+C*y.ac)),p.rc=B*(v*p.rc+C*y.rc),p.gc=B*(v*p.gc+C*y.gc),p.bc=B*(v*p.bc+C*y.bc),p.cnt+=y.cnt,p.mtm=++u,s[y.bk].fw=y.fw,s[y.fw].bk=y.bk,y.mtm=b}let M=[];var L=0;for(u=0;;++L){let O=V(Math.round(s[u].rc),0,255),k=V(Math.round(s[u].gc),0,255),Y=V(Math.round(s[u].bc),0,255),E=255;if(l){if(E=V(Math.round(s[u].ac),0,255),c){let lt=typeof c=="number"?c:127;E=E<=lt?0:255}n&&E<=f&&(O=k=Y=o,E=0)}let X=l?[O,k,Y,E]:[O,k,Y];if(wt(M,X)||M.push(X),(u=s[u].fw)==0)break}return M}function wt(t,e){for(let i=0;i<t.length;i++){let r=t[i],n=r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2],o=r.length>=4&&e.length>=4?r[3]===e[3]:!0;if(n&&o)return!0}return!1}function z(t,e){var i=0,r;for(r=0;r<t.length;r++){let n=t[r]-e[r];i+=n*n}return i}function P(t,e){return e>1?Math.round(t/e)*e:t}function nt(t,{roundRGB:e=5,roundAlpha:i=10,oneBitAlpha:r=null}={}){let n=new Uint32Array(t.buffer);for(let o=0;o<n.length;o++){let f=n[o],c=f>>24&255,x=f>>16&255,a=f>>8&255,l=f&255;if(c=P(c,i),r){let s=typeof r=="number"?r:127;c=c<=s?0:255}l=P(l,e),a=P(a,e),x=P(x,e),n[o]=c<<24|x<<16|a<<8|l<<0}}function rt(t,e,i="rgb565"){if(!t||!t.buffer)throw new Error("quantize() expected RGBA Uint8Array data");if(!(t instanceof Uint8Array)&&!(t instanceof Uint8ClampedArray))throw new Error("quantize() expected RGBA Uint8Array data");if(e.length>256)throw new Error("applyPalette() only works with 256 colors or less");D(i);let r=new Uint32Array(t.buffer),n=r.length,o=i==="rgb444"?4096:65536,f=new Uint8Array(n),c=new Array(o);if(i==="rgba4444")for(let x=0;x<n;x++){let a=r[x],l=a>>24&255,s=a>>16&255,w=a>>8&255,b=a&255,g=j(b,w,s,l),h=g in c?c[g]:c[g]=dt(b,w,s,l,e);f[x]=h}else{let x=i==="rgb444"?R:G;for(let a=0;a<n;a++){let l=r[a],s=l>>16&255,w=l>>8&255,b=l&255,g=x(b,w,s),h=g in c?c[g]:c[g]=bt(b,w,s,e);f[a]=h}}return f}function dt(t,e,i,r,n){let o=0,f=1e100;for(let c=0;c<n.length;c++){let x=n[c],a=x[3],l=U(a-r);if(l>f)continue;let s=x[0];if(l+=U(s-t),l>f)continue;let w=x[1];if(l+=U(w-e),l>f)continue;let b=x[2];l+=U(b-i),!(l>f)&&(f=l,o=c)}return o}function bt(t,e,i,r){let n=0,o=1e100;for(let f=0;f<r.length;f++){let c=r[f],x=c[0],a=U(x-t);if(a>o)continue;let l=c[1];if(a+=U(l-e),a>o)continue;let s=c[2];a+=U(s-i),!(a>o)&&(o=a,n=f)}return n}function ot(t,e,i=5){if(!t.length||!e.length)return;let r=t.map(f=>f.slice(0,3)),n=i*i,o=t[0].length;for(let f=0;f<e.length;f++){let c=e[f];c.length<o?c=[c[0],c[1],c[2],255]:c.length>o?c=c.slice(0,3):c=c.slice();let x=W(r,c.slice(0,3),z),a=x[0],l=x[1];l>0&&l<=n&&(t[a]=c)}}function U(t){return t*t}function Z(t,e,i=z){let r=Infinity,n=-1;for(let o=0;o<t.length;o++){let f=t[o],c=i(e,f);c<r&&(r=c,n=o)}return n}function W(t,e,i=z){let r=Infinity,n=-1;for(let o=0;o<t.length;o++){let f=t[o],c=i(e,f);c<r&&(r=c,n=o)}return[n,r]}function it(t,e,i=z){return t[Z(t,e,i)]}function st(t={}){let{initialCapacity:e=4096,auto:i=!0}=t,r=T(e),n=5003,o=new Uint8Array(256),f=new Int32Array(n),c=new Int32Array(n),x=!1;return{reset(){r.reset(),x=!1},finish(){r.writeByte(J.trailer)},bytes(){return r.bytes()},bytesView(){return r.bytesView()},get buffer(){return r.buffer},get stream(){return r},writeHeader:a,writeFrame(l,s,w,b={}){let{transparent:g=!1,transparentIndex:h=0,delay:B=0,palette:u=null,repeat:m=0,colorDepth:_=8,dispose:d=-1}=b,A=!1;if(i?x||(A=!0,a(),x=!0):A=Boolean(b.first),s=Math.max(0,Math.floor(s)),w=Math.max(0,Math.floor(w)),A){if(!u)throw new Error("First frame must include a { palette } option");ht(r,s,w,u,_),ft(r,u),m>=0&&yt(r,m)}let F=Math.round(B/10);pt(r,d,F,g,h);let p=Boolean(u)&&!A;Bt(r,s,w,p?u:null),p&&ft(r,u),_t(r,l,s,w,_,o,f,c)}};function a(){ct(r,"GIF89a")}}function pt(t,e,i,r,n){t.writeByte(33),t.writeByte(249),t.writeByte(4),n<0&&(n=0,r=!1);var o,f;r?(o=1,f=2):(o=0,f=0),e>=0&&(f=e&7),f<<=2;let c=0;t.writeByte(0|f|c|o),S(t,i),t.writeByte(n||0),t.writeByte(0)}function ht(t,e,i,r,n=8){let o=1,f=0,c=K(r.length)-1,x=o<<7|n-1<<4|f<<3|c,a=0,l=0;S(t,e),S(t,i),t.writeBytes([x,a,l])}function yt(t,e){t.writeByte(33),t.writeByte(255),t.writeByte(11),ct(t,"NETSCAPE2.0"),t.writeByte(3),t.writeByte(1),S(t,e),t.writeByte(0)}function ft(t,e){let i=1<<K(e.length);for(let r=0;r<i;r++){let n=[0,0,0];r<e.length&&(n=e[r]),t.writeByte(n[0]),t.writeByte(n[1]),t.writeByte(n[2])}}function Bt(t,e,i,r){if(t.writeByte(44),S(t,0),S(t,0),S(t,e),S(t,i),r){let n=0,o=0,f=K(r.length)-1;t.writeByte(128|n|o|0|f)}else t.writeByte(0)}function _t(t,e,i,r,n=8,o,f,c){tt(i,r,e,n,t,o,f,c)}function S(t,e){t.writeByte(e&255),t.writeByte(e>>8&255)}function ct(t,e){for(var i=0;i<e.length;i++)t.writeByte(e.charCodeAt(i))}function K(t){return Math.max(Math.ceil(Math.log2(t)),1)}var At=st;export{st as GIFEncoder,rt as applyPalette,At as default,it as nearestColor,Z as nearestColorIndex,W as nearestColorIndexWithDistance,nt as prequantize,N as quantize,ot as snapColorsToPalette};
//# sourceMappingURL=gifenc.esm.js.map
