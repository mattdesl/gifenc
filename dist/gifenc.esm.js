var K={signature:"GIF",version:"89a",trailer:59,extensionIntroducer:33,applicationExtensionLabel:255,graphicControlExtensionLabel:249,imageSeparator:44,signatureSize:3,versionSize:3,globalColorTableFlagMask:128,colorResolutionMask:112,sortFlagMask:8,globalColorTableSizeMask:7,applicationIdentifierSize:8,applicationAuthCodeSize:3,disposalMethodMask:28,userInputFlagMask:2,transparentColorFlagMask:1,localColorTableFlagMask:128,interlaceFlagMask:64,idSortFlagMask:32,localColorTableSizeMask:7};function F(t=256){let e=0,s=new Uint8Array(t);return{get buffer(){return s.buffer},reset(){e=0},bytesView(){return s.subarray(0,e)},bytes(){return s.slice(0,e)},writeByte(r){n(e+1),s[e]=r,e++},writeBytes(r,o=0,i=r.length){n(e+i);for(let f=0;f<i;f++)s[e++]=r[f+o]},writeBytesView(r,o=0,i=r.byteLength){n(e+i),s.set(r.subarray(o,o+i),e),e+=i}};function n(r){var o=s.length;if(o>=r)return;var i=1024*1024;r=Math.max(r,o*(o<i?2:1.125)>>>0),o!=0&&(r=Math.max(r,256));let f=s;s=new Uint8Array(r),e>0&&s.set(f.subarray(0,e),0)}}var O=12,J=5003,lt=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];function at(t,e,s,n,r=F(512),o=new Uint8Array(256),i=new Int32Array(J),f=new Int32Array(J)){let x=i.length,a=Math.max(2,n);o.fill(0),f.fill(0),i.fill(-1);let l=0,c=0,g=a+1,y=g,b=!1,w=y,_=(1<<w)-1,u=1<<g-1,v=u+1,B=u+2,h=0,A=s[0],z=0;for(let d=x;d<65536;d*=2)++z;z=8-z,r.writeByte(a),I(u);let p=s.length;for(let d=1;d<p;d++){t:{let m=s[d],C=(m<<O)+A,M=m<<z^A;if(i[M]===C){A=f[M];break t}let V=M===0?1:x-M;for(;i[M]>=0;)if(M-=V,M<0&&(M+=x),i[M]===C){A=f[M];break t}I(A),A=m,B<1<<O?(f[M]=B++,i[M]=C):(i.fill(-1),B=u+2,b=!0,I(u))}}return I(A),I(v),r.writeByte(0),r.bytesView();function I(d){for(l&=lt[c],c>0?l|=d<<c:l=d,c+=w;c>=8;)o[h++]=l&255,h>=254&&(r.writeByte(h),r.writeBytesView(o,0,h),h=0),l>>=8,c-=8;if((B>_||b)&&(b?(w=y,_=(1<<w)-1,b=!1):(++w,_=w===O?1<<w:(1<<w)-1)),d==v){for(;c>0;)o[h++]=l&255,h>=254&&(r.writeByte(h),r.writeBytesView(o,0,h),h=0),l>>=8,c-=8;h>0&&(r.writeByte(h),r.writeBytesView(o,0,h),h=0)}}}var $=at;function D(t,e,s){return t<<8&63488|e<<2&992|s>>3}function G(t,e,s,n){return t>>4|e&240|(s&240)<<4|(n&240)<<8}function j(t,e,s){return t>>4<<8|e&240|s>>4}function R(t,e,s){return t<e?e:t>s?s:t}function T(t){return t*t}function tt(t,e,s){var n=0,r=1e100;let o=t[e],i=o.cnt,f=o.ac,x=o.rc,a=o.gc,l=o.bc;for(var c=o.fw;c!=0;c=t[c].fw){let y=t[c],b=y.cnt,w=i*b/(i+b);if(!(w>=r)){var g=0;s&&(g+=w*T(y.ac-f),g>=r)||(g+=w*T(y.rc-x),!(g>=r)&&(g+=w*T(y.gc-a),!(g>=r)&&(g+=w*T(y.bc-l),!(g>=r)&&(r=g,n=c))))}}o.err=r,o.nn=n}function Q(){return{ac:0,rc:0,gc:0,bc:0,cnt:0,nn:0,fw:0,bk:0,tm:0,mtm:0,err:0}}function ut(t,e){let s=e==="rgb444"?4096:65536,n=new Array(s),r=t.length;if(e==="rgba4444")for(let o=0;o<r;++o){let i=t[o],f=i>>24&255,x=i>>16&255,a=i>>8&255,l=i&255,c=G(l,a,x,f),g=c in n?n[c]:n[c]=Q();g.rc+=l,g.gc+=a,g.bc+=x,g.ac+=f,g.cnt++}else if(e==="rgb444")for(let o=0;o<r;++o){let i=t[o],f=i>>16&255,x=i>>8&255,a=i&255,l=j(a,x,f),c=l in n?n[l]:n[l]=Q();c.rc+=a,c.gc+=x,c.bc+=f,c.cnt++}else for(let o=0;o<r;++o){let i=t[o],f=i>>16&255,x=i>>8&255,a=i&255,l=D(a,x,f),c=l in n?n[l]:n[l]=Q();c.rc+=a,c.gc+=x,c.bc+=f,c.cnt++}return n}function H(t,e,s={}){let{format:n="rgb565",clearAlpha:r=!0,clearAlphaColor:o=0,clearAlphaThreshold:i=0,oneBitAlpha:f=!1}=s;if(!t||!t.buffer)throw new Error("quantize() expected RGBA Uint8Array data");if(!(t instanceof Uint8Array)&&!(t instanceof Uint8ClampedArray))throw new Error("quantize() expected RGBA Uint8Array data");let x=new Uint32Array(t.buffer),a=s.useSqrt!==!1,l=n==="rgba4444",c=ut(x,n),g=c.length,y=g-1,b=new Uint32Array(g+1);for(var w=0,u=0;u<g;++u){let k=c[u];if(k!=null){var _=1/k.cnt;l&&(k.ac*=_),k.rc*=_,k.gc*=_,k.bc*=_,c[w++]=k}}T(e)/w<.022&&(a=!1);for(var u=0;u<w-1;++u)c[u].fw=u+1,c[u+1].bk=u,a&&(c[u].cnt=Math.sqrt(c[u].cnt));a&&(c[u].cnt=Math.sqrt(c[u].cnt));var v,B,h;for(u=0;u<w;++u){tt(c,u,!1);var A=c[u].err;for(B=++b[0];B>1&&(h=B>>1,!(c[v=b[h]].err<=A));B=h)b[B]=v;b[B]=u}var z=w-e;for(u=0;u<z;){for(var p;;){var I=b[1];if(p=c[I],p.tm>=p.mtm&&c[p.nn].mtm<=p.tm)break;p.mtm==y?I=b[1]=b[b[0]--]:(tt(c,I,!1),p.tm=u);var A=c[I].err;for(B=1;(h=B+B)<=b[0]&&(h<b[0]&&c[b[h]].err>c[b[h+1]].err&&h++,!(A<=c[v=b[h]].err));B=h)b[B]=v;b[B]=I}var d=c[p.nn],m=p.cnt,C=d.cnt,_=1/(m+C);l&&(p.ac=_*(m*p.ac+C*d.ac)),p.rc=_*(m*p.rc+C*d.rc),p.gc=_*(m*p.gc+C*d.gc),p.bc=_*(m*p.bc+C*d.bc),p.cnt+=d.cnt,p.mtm=++u,c[d.bk].fw=d.fw,c[d.fw].bk=d.bk,d.mtm=y}let M=[];var V=0;for(u=0;;++V){let Y=R(Math.round(c[u].rc),0,255),k=R(Math.round(c[u].gc),0,255),L=R(Math.round(c[u].bc),0,255),E=255;if(l){if(E=R(Math.round(c[u].ac),0,255),f){let st=typeof f=="number"?f:127;E=E<=st?0:255}r&&E<=i&&(Y=k=L=o,E=0)}let Z=l?[Y,k,L,E]:[Y,k,L];if(xt(M,Z)||M.push(Z),(u=c[u].fw)==0)break}return M}function xt(t,e){for(let s=0;s<t.length;s++){let n=t[s],r=n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2],o=n.length>=4&&e.length>=4?n[3]===e[3]:!0;if(r&&o)return!0}return!1}function U(t,e){var s=0,n;for(n=0;n<t.length;n++){let r=t[n]-e[n];s+=r*r}return s}function P(t,e){return e>1?Math.round(t/e)*e:t}function et(t,{roundRGB:e=5,roundAlpha:s=10,oneBitAlpha:n=null}={}){let r=new Uint32Array(t.buffer);for(let o=0;o<r.length;o++){let i=r[o],f=i>>24&255,x=i>>16&255,a=i>>8&255,l=i&255;if(f=P(f,s),n){let c=typeof n=="number"?n:127;f=f<=c?0:255}l=P(l,e),a=P(a,e),x=P(x,e),r[o]=f<<24|x<<16|a<<8|l<<0}}function nt(t,e,s="rgb565"){if(!t||!t.buffer)throw new Error("quantize() expected RGBA Uint8Array data");if(!(t instanceof Uint8Array)&&!(t instanceof Uint8ClampedArray))throw new Error("quantize() expected RGBA Uint8Array data");if(e.length>256)throw new Error("applyPalette() only works with 256 colors or less");let n=new Uint32Array(t.buffer),r=n.length,o=s==="rgb444"?4096:65536,i=new Uint8Array(r),f=new Array(o),x=s==="rgba4444";if(s==="rgba4444")for(let a=0;a<r;a++){let l=n[a],c=l>>24&255,g=l>>16&255,y=l>>8&255,b=l&255,w=G(b,y,g,c),_=w in f?f[w]:f[w]=gt(b,y,g,c,e);i[a]=_}else{let a=s==="rgb444"?j:D;for(let l=0;l<r;l++){let c=n[l],g=c>>16&255,y=c>>8&255,b=c&255,w=a(b,y,g),_=w in f?f[w]:f[w]=bt(b,y,g,e);i[l]=_}}return i}function gt(t,e,s,n,r){let o=0,i=1e100;for(let f=0;f<r.length;f++){let x=r[f],a=x[3],l=q(a-n);if(l>i)continue;let c=x[0];if(l+=q(c-t),l>i)continue;let g=x[1];if(l+=q(g-e),l>i)continue;let y=x[2];l+=q(y-s),!(l>i)&&(i=l,o=f)}return o}function bt(t,e,s,n){let r=0,o=1e100;for(let i=0;i<n.length;i++){let f=n[i],x=f[0],a=q(x-t);if(a>o)continue;let l=f[1];if(a+=q(l-e),a>o)continue;let c=f[2];a+=q(c-s),!(a>o)&&(o=a,r=i)}return r}function rt(t,e,s=5){if(!t.length||!e.length)return;let n=t.map(i=>i.slice(0,3)),r=s*s,o=t[0].length;for(let i=0;i<e.length;i++){let f=e[i];f.length<o?f=[f[0],f[1],f[2],255]:f.length>o?f=f.slice(0,3):f=f.slice();let x=N(n,f.slice(0,3),U),a=x[0],l=x[1];l>0&&l<=r&&(t[a]=f)}}function q(t){return t*t}function W(t,e,s=U){let n=Infinity,r=-1;for(let o=0;o<t.length;o++){let i=t[o],f=s(e,i);f<n&&(n=f,r=o)}return r}function N(t,e,s=U){let n=Infinity,r=-1;for(let o=0;o<t.length;o++){let i=t[o],f=s(e,i);f<n&&(n=f,r=o)}return[r,n]}function ot(t,e,s=U){return t[W(t,e,s)]}function ct(t={}){let{initialCapacity:e=4096,auto:s=!0}=t,n=F(e),r=5003,o=new Uint8Array(256),i=new Int32Array(r),f=new Int32Array(r),x=!1;return{reset(){n.reset(),x=!1},finish(){n.writeByte(K.trailer)},bytes(){return n.bytes()},bytesView(){return n.bytesView()},get buffer(){return n.buffer},get stream(){return n},writeHeader:a,writeFrame(l,c,g,y={}){let{transparent:b=!1,transparentIndex:w=0,delay:_=0,palette:u=null,repeat:v=0,colorDepth:B=8,dispose:h=-1,x:A=0,y:z=0}=y,p=!1;s?x||(p=!0,a(),x=!0):p=Boolean(y.first);let I=Math.max(0,Math.floor(A)),d=Math.max(0,Math.floor(z));if(c=Math.max(0,Math.floor(c)),g=Math.max(0,Math.floor(g)),p){if(!u)throw new Error("First frame must include a { palette } option");ht(n,c,g,u,B),it(n,u),v>=0&&pt(n,v)}let m=Math.round(_/10);wt(n,h,m,b,w);let C=Boolean(u)&&!p;dt(n,I,d,c,g,C?u:null),C&&it(n,u),yt(n,l,c,g,B,o,i,f)}};function a(){ft(n,"GIF89a")}}function wt(t,e,s,n,r){t.writeByte(33),t.writeByte(249),t.writeByte(4),r<0&&(r=0,n=!1);var o,i;n?(o=1,i=2):(o=0,i=0),e>=0&&(i=e&7),i<<=2;let f=0;t.writeByte(0|i|f|o),S(t,s),t.writeByte(r||0),t.writeByte(0)}function ht(t,e,s,n,r=8){let o=1,i=0,f=X(n.length)-1,x=o<<7|r-1<<4|i<<3|f,a=0,l=0;S(t,e),S(t,s),t.writeBytes([x,a,l])}function pt(t,e){t.writeByte(33),t.writeByte(255),t.writeByte(11),ft(t,"NETSCAPE2.0"),t.writeByte(3),t.writeByte(1),S(t,e),t.writeByte(0)}function it(t,e){let s=1<<X(e.length);for(let n=0;n<s;n++){let r=[0,0,0];n<e.length&&(r=e[n]),t.writeByte(r[0]),t.writeByte(r[1]),t.writeByte(r[2])}}function dt(t,e,s,n,r,o){if(t.writeByte(44),S(t,e),S(t,s),S(t,n),S(t,r),o){let i=0,f=0,x=X(o.length)-1;t.writeByte(128|i|f|0|x)}else t.writeByte(0)}function yt(t,e,s,n,r=8,o,i,f){$(s,n,e,r,t,o,i,f)}function S(t,e){t.writeByte(e&255),t.writeByte(e>>8&255)}function ft(t,e){for(var s=0;s<e.length;s++)t.writeByte(e.charCodeAt(s))}function X(t){return Math.max(Math.ceil(Math.log2(t)),1)}var Bt=ct;export{ct as GIFEncoder,nt as applyPalette,Bt as default,ot as nearestColor,W as nearestColorIndex,N as nearestColorIndexWithDistance,et as prequantize,H as quantize,rt as snapColorsToPalette};
//# sourceMappingURL=gifenc.esm.js.map
